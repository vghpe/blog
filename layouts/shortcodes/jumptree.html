<!DOCTYPE html>
<html>
<head>
  <title>Jump Over Tree</title>
  <style>
    #game {
      position: relative;
      width: 100%;
      max-width: 500px;
      height: 100px;
      background: #e8f5e9;
      overflow: hidden;
      border: 2px solid #81c784;
      margin: 10px auto 0;
      text-align: center;
      border-radius: 6px;
      touch-action: manipulation;
    }
    #player {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 20px;
      height: 20px;
      box-sizing: border-box;
      border-radius: 4px;
      transform-origin: center bottom;
      transition: transform 0.1s ease-out;
    }
    .frozen-start { background: #fffde7; outline: 2px solid #fbc02d; }
    .normal       { background: #4db6ac; outline: none; }
    .frozen-death { background: #ef9a9a; outline: none; }

    .tree {
      position: absolute;
      bottom: 0;
      width: 10px;
      height: 30px;
      background: #8d6e63;
      border-radius: 2px;
    }
    #tree1::after, #tree2::after {
      content: '';
      position: absolute;
      bottom: 20px;
      left: -5px;
      width: 20px;
      height: 20px;
      background: #66bb6a;
      border-radius: 50%;
    }
    #message {
      margin: 15px 0 0 0;
      font-size: 16px;
      color: #37474f;
      text-align: center;
      line-height: 1.4em;
      min-height: 2em;
      font-family: inherit;
    }
    #resetBtn {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      background: #fff;
      border: 2px solid #81c784;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      line-height: 36px;
      color: #388e3c;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="player" class="frozen-start"></div>
    <div id="tree1" class="tree" style="left: 35%;"></div>
    <div id="tree2" class="tree" style="left: 65%;"></div>
    <button id="resetBtn">â†»</button>
  </div>
  <div id="message">Tap to jump</div>

  <script>
    // Tunables (60fps baseline for jump)
    const JUMP_STRENGTH = 7;   // higher = taller jump
    const GRAVITY_UP = 0.32;   // gravity applied while rising
    const GRAVITY_MID = 0.40;  // gravity applied near peak
    const GRAVITY_DOWN = 0.65; // gravity applied while falling

    const PLAYER_SPEED = 130;    // px/sec (time-based)
    const START_FREEZE_TIME = 1000;
    const DEATH_FREEZE_TIME = 500;
    const PLAYER_START_OFFSET = 10;
    const DEATH_WIGGLE_DISTANCE = 1;

    const player = document.getElementById('player');
    const tree1 = document.getElementById('tree1');
    const tree2 = document.getElementById('tree2');
    const game = document.getElementById('game');
    const message = document.getElementById('message');
    const resetBtn = document.getElementById('resetBtn');

    const encodedEmail = 'Z2cwMmhwZUBnbWFpbC5jb20=';

    let isJumping = false;
    let jumpHeight = 0;
    let velocity = 0;
    let playerX = PLAYER_START_OFFSET;
    let won = false;
    let frozen = true;
    let wiggleInterval = null;
    let lastTime = null;

    function setFrozenStart(state) {
      frozen = state;
      player.className = state ? 'frozen-start' : 'normal';
    }

    function setFrozenDeath() {
      frozen = true;
      player.className = 'frozen-death';
      let direction = 1;
      wiggleInterval = setInterval(() => {
        player.style.left = (playerX + (direction * DEATH_WIGGLE_DISTANCE)) + 'px';
        direction *= -1;
      }, 100);
    }

    function clearWiggle() {
      if (wiggleInterval) { clearInterval(wiggleInterval); wiggleInterval = null; }
    }

    function resetPlayer() {
      clearWiggle();
      playerX = PLAYER_START_OFFSET;
      jumpHeight = 0;
      velocity = 0;
      isJumping = false;
      won = false;
      player.style.left = playerX + 'px';
      player.style.bottom = jumpHeight + 'px';
      player.style.transform = 'scaleY(1) scaleX(1)';
      message.innerHTML = 'Tap to jump';
      resetBtn.style.display = 'none';
      setFrozenStart(true);
      setTimeout(() => { setFrozenStart(false); }, START_FREEZE_TIME);
    }

    function checkCollision(tree) {
      const playerRect = player.getBoundingClientRect();
      const treeRect = tree.getBoundingClientRect();
      return (
        playerRect.left < treeRect.right &&
        playerRect.right > treeRect.left &&
        playerRect.bottom > treeRect.top
      );
    }

    function gameLoop(ts) {
      if (lastTime === null) lastTime = ts;
      const deltaSec = Math.min((ts - lastTime) / 1000, 0.05); // clamp huge gaps
      const dt60 = deltaSec * 60; // 60fps baseline scaler
      lastTime = ts;

      if (!won && !frozen) {
        // Horizontal: time-based
        playerX += PLAYER_SPEED * deltaSec;
        player.style.left = playerX + 'px';

        // Vertical: normalized to 60fps baseline
        if (isJumping) {
          jumpHeight += velocity * dt60;

          if (velocity > 2) {
            velocity -= GRAVITY_UP * dt60;
          } else if (velocity > -2) {
            velocity -= GRAVITY_MID * dt60;
          } else {
            velocity -= GRAVITY_DOWN * dt60;
          }

          if (jumpHeight <= 0) {
            jumpHeight = 0;
            isJumping = false;
            player.style.transform = 'scaleY(0.6) scaleX(1.4)';
            setTimeout(() => { player.style.transform = 'scaleY(1) scaleX(1)'; }, 150);
          } else {
            const v = Math.max(0, velocity);
            const stretch = 1 + v * 0.05;
            const squash  = 1 - v * 0.02;
            player.style.transform = `scaleY(${stretch}) scaleX(${squash})`;
          }

          player.style.bottom = jumpHeight + 'px';
        }

        if (checkCollision(tree1) || checkCollision(tree2)) {
          setFrozenDeath();
          setTimeout(() => { resetPlayer(); }, DEATH_FREEZE_TIME);
        }

        if (playerX + player.offsetWidth >= game.offsetWidth) {
          const email = atob(encodedEmail);
          message.innerHTML = 'You did it! Email: <a href="mailto:' + email + '">' + email + '</a>';
          const placeholder = document.getElementById('jumptree-email');
          if (placeholder) {
            placeholder.innerHTML = '<a href="mailto:' + email + '">' + email + '</a>';
          }
          won = true;
          resetBtn.style.display = 'block';
        }
      }

      requestAnimationFrame(gameLoop);
    }

    function jump() {
      if (isJumping || frozen) return;
      isJumping = true;
      velocity = JUMP_STRENGTH; // 60fps baseline
    }

    game.addEventListener('pointerdown', (e) => {
      if (e.target !== resetBtn && !won) jump();
    });

    resetBtn.addEventListener('click', resetPlayer);

    resetPlayer();
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
